version: '3.8'

services:
  # PRO TIP: We removed the 'partykit' service because you are running 'npx partykit dev' on your host machine.
  # This setup makes the Dockerized Agent talk to your LOCAL PartyKit server so you can see it!

  agent-fleet:
    build: .
    # Use 'watch' to restart on file changes
    command: npx tsx watch agent/fleet.ts
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      # Connect to the host machine's PartyKit server (User's 'npx partykit dev')
      - NEXT_PUBLIC_PARTYKIT_HOST=host.docker.internal:1999
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      # Pass through other env vars if needed
    ports:
      - '3000:3000'
    extra_hosts:
      - 'host.docker.internal:host-gateway'
